<div
#root
class="table-box"
[class.outside]="isOutside"
[class.error]="isError"
[class.selection]="selectionMode"
[style.transform]="'translate3d(' + x + 'px,' + y + 'px,0)'"
[style.width.px]="width"
(mousedown)="onMouseDown($event)"
(click)="onTableClick($event)">
  <header class="table-header" [class.error]="isError" [class.outside]="isOutside" [class.selection]="selectionMode">
    <div class="table-name" (dblclick)="requestTableEdit()">
      @if(isEditing){
        <input
          #visibleInput
          type="text"
          [value]="table?.name"
          (input)="onEditInput($event)"
          (keydown)="onKeyDown($event)"
        />
      } @else {
        <span class="table-name" [ngStyle]="{ maxWidth: width + 'px'}">{{ table?.name || 'NuevaTabla' }}</span>
      }
    </div>
  </header>

  <body class="table-columns">
    @for(col of table?.columns; let i = $index; track col.name){
      <div class="column-row" [class.outside]="isOutside" [class.error]="isError" [class.selection]="selectionMode" (dblclick)="requestColumnEdit(i)">
        <div class="column-container-name" [ngStyle]="{ maxWidth: width - 100 + 'px'}">
          @if(isEditingCol === i){
            <input
              #colInput
              type="text"
              [value]="col.name"
              (input)="onEditInput($event)"
              (keydown)="onKeyDown($event)"
            />
          } @else {
            <span class="column-name" [ngStyle]="{ maxWidth: width -100 + 'px'}">{{ col.name }}</span>
          }
        </div>
        <div class="column-type">
          @if(isEditingCol === i){
            <app-pg-type-select
              [value]="getFormatType(col.type)"
              (valueChange)="onColumnTypeChange(i, $event)"
              (keydown)="onKeyDown($event)"
            ></app-pg-type-select>
          } @else {
            <span>{{ col.type }}</span>
          }
        </div>

        @if(columnState && !selectionMode && !disabled){
          <button
            type="button"
            class="add-col-btn"
            (mousedown)="$event.stopPropagation()"
            (click)="onAddColumnAfter(i, $event)"
            aria-label="A単adir columna"
            title="A単adir columna"
          >+
          </button>
        }

        @if(columnState && getAction.Create === columnState && !selectionMode && !disabled){
          <button
            type="button"
            class="add-col-btn"
            (mousedown)="$event.stopPropagation()"
            (click)="onAddColumnAfter(i, $event)"
            aria-label="A単adir columna"
            title="A単adir columna"
          >+
          </button>
        }
        @else if(columnState && getAction.Delete === columnState && !selectionMode && !disabled){
          <button
            type="button"
            class="drop-col-btn"
            (mousedown)="$event.stopPropagation()"
            (click)="onDropColumnCurrent(i, $event)"
            aria-label="Quitar columna"
            title="Quitar columna"
          >-
          </button>
        }

        @else if(columnState && getAction.Edit === columnState && !selectionMode && !disabled){

        }
        @else if(columnState && getAction.Reorder === columnState && !selectionMode && !disabled){

        }
      </div>
    }
  </body>

  <div class="resize-handle" (mousedown)="startResize($event)"></div>
</div>
